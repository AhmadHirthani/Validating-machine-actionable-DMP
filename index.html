<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet"  type = "text/css" href = "style.css" >
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <title> Validate maDMP</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/ajv/6.10.0/ajv.bundle.js"></script>
    <script src="bundle.js"></script>
    <style type="text/css">
        body{background-color: #F8FFF8;
            height: auto;
            width:97%;
            margin: 2%;}
        img.logo{background-position: top left}
        #vaildresultID {color:green; font-size: 23PX;font-weight: bold}
        #invaildresultID {color: red; font-size: 25PX;font-weight: bold}
        #datapathlabelID,#messagelabelID {color: red; font-size: 20PX; font-weight: bold}
        #errdataPathID,#errmessageID{font-size: 20PX; font-weight: bold}
    </style>
</head>
<body>
<div class="container">
    <nav class="navbar navbar-light" style="background-color:#9BD692;">
        <a class="navbar-brand" href="#">
            <img src="rda-logo.png" class="d-inline-block align-top" alt="">
        </a>
        <img src="TUWIEN-Logo.png" width="400" align="right">
    </nav>
</div>
<div class="container">
    <textarea rows="5" cols="5" id="schmaID" style="display:none;"></textarea><br>
    <p   class="text-justify text-center lead font-weight-bold">
        Validating maDMP against RDA DMP schema <br>
        Tool for <strong> validating machine actionable </strong>data management plan against <strong>RDA DMP</strong> standard schema
    </p>
    <form action="<?php echo $_SERVER['PHP_SELF'];?> " method="POST">
        <textarea style="" rows="15" cols="155" id="dataID"  placeholder="Put your maDMP here, please!!"></textarea>
    </form>

    <div>
        <button  id="button" onclick="validate()" type="button" class="btn btn-success">Test Validation</button><br>
        <label id="vaildresultID"></label>
        <label id="invaildresultID"></label><br>
        <label id="datapathlabelID"></label>
        <label id="errdataPathID"></label><br>
        <label id="messagelabelID"></label>
        <label id="errmessageID"></label>
    </div>

    <script type="text/javascript">
        var nesne ;
        if(navigator.appName.search('Microsoft')>-1) { nesne = new ActiveXObject('MSXML2.XMLHTTP'); }
        else { nesne = new XMLHttpRequest(); }
        nesne.ad='schmaID';
        nesne.open('get', 'schema.json', true);
        nesne.onreadystatechange= cevap;
        nesne.send(null);
        function cevap() {
            if(this.readyState==4) {
                var el = document.getElementById(this.ad);
                el.innerHTML = this.responseText;
            }
        }
        function validate(){
            document.getElementById('vaildresultID').innerHTML = "";
            document.getElementById('invaildresultID').innerHTML = "";
            document.getElementById('datapathlabelID').innerHTML = "";
            document.getElementById('errdataPathID').innerHTML = "";
            document.getElementById('messagelabelID').innerHTML = "";
            document.getElementById('errmessageID').innerHTML = "";


            var maDMP = document.getElementById("dataID").value;
            var maDMPJSON = JSON.parse(maDMP);
            //var maDMPJSON = JSON.parse(maDMP.substring(1, maDMP.length));
            console.log("maDMPJSON");
            console.log(maDMPJSON);

            var schema = document.getElementById("schmaID").textContent;
            var schemaJSON = JSON.parse(schema);
            //var schemaJSON = JSON.parse(schema.substring(1, schema.length));
            console.log("schemaJSON");
            console.log(schemaJSON);



            var ajv = new Ajv(); // options can be passed, e.g. {allErrors: true}
            var validate = ajv.compile(schemaJSON);
            var valid = validate(maDMPJSON);
            if (!valid) {
                console.log("validate.errors");
                console.log(validate.errors);
                var errors=validate.errors;
                document.getElementById('invaildresultID').innerHTML = "Not validated maDMP" ;
                document.getElementById('datapathlabelID').innerHTML ="Data Path: ";
                document.getElementById('errdataPathID').innerHTML =errors[0]['dataPath'];
                document.getElementById('messagelabelID').innerHTML = "Message: ";
                document.getElementById('errmessageID').innerHTML =errors[0]['message'];
                console.log("invalid");
            }
            else {
                document.getElementById('vaildresultID').innerHTML = "Validated maDMP" ;
                console.log("valid");
            }


        }
    </script>
    <hr color= "#9BD692">
    <div>
        <footer><p class="lead text-center"> &copy Devloped by <strong>Ahmad Alhirthani</strong> for the course From design to software in <strong> TUWIEN</strong><br>
            &copy Designed by<strong> Samiha Albakri</strong>
        </p>
        </footer>
    </div>

</div>
</body>
</html>
